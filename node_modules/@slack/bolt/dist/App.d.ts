import { WebClient } from '@slack/web-api';
import { Logger, LogLevel } from '@slack/logger';
import { ExpressReceiverOptions } from './ExpressReceiver';
import { ConversationStore } from './conversation-store';
import { Middleware, AnyMiddlewareArgs, SlackActionMiddlewareArgs, SlackCommandMiddlewareArgs, SlackEventMiddlewareArgs, SlackOptionsMiddlewareArgs, SlackAction, OptionsSource, Receiver, ReceiverEvent } from './types';
import { ErrorCode, CodedError } from './errors';
/** App initialization options */
export interface AppOptions {
    signingSecret?: ExpressReceiverOptions['signingSecret'];
    endpoints?: ExpressReceiverOptions['endpoints'];
    convoStore?: ConversationStore | false;
    token?: AuthorizeResult['botToken'];
    botId?: AuthorizeResult['botId'];
    botUserId?: AuthorizeResult['botUserId'];
    authorize?: Authorize;
    receiver?: Receiver;
    logger?: Logger;
    logLevel?: LogLevel;
    ignoreSelf?: boolean;
}
export { LogLevel, Logger } from '@slack/logger';
/** Authorization function - seeds the middleware processing and listeners with an authorization context */
export interface Authorize {
    (source: AuthorizeSourceData, body: ReceiverEvent['body']): Promise<AuthorizeResult>;
}
/** Authorization function inputs - authenticated data about an event for the authorization function */
export interface AuthorizeSourceData {
    teamId: string;
    enterpriseId?: string;
    userId?: string;
    conversationId?: string;
}
/** Authorization function outputs - data that will be available as part of event processing */
export interface AuthorizeResult {
    botToken?: string;
    userToken?: string;
    botId?: string;
    botUserId?: string;
    [key: string]: any;
}
export interface ActionConstraints {
    block_id?: string | RegExp;
    action_id?: string | RegExp;
    callback_id?: string | RegExp;
}
export interface ErrorHandler {
    (error: CodedError): void;
}
/**
 * A Slack App
 */
export default class App {
    /** Slack Web API client */
    client: WebClient;
    /** Receiver - ingests events from the Slack platform */
    private receiver;
    /** Logger */
    private logger;
    /**  */
    private authorize;
    /** Global middleware */
    private middleware;
    /** Listeners (and their middleware) */
    private listeners;
    private errorHandler;
    constructor({ signingSecret, endpoints, receiver, convoStore, token, botId, botUserId, authorize, logger, logLevel, ignoreSelf, }?: AppOptions);
    /**
     * Register a new middleware, processed in the order registered.
     *
     * @param m global middleware function
     */
    use(m: Middleware<AnyMiddlewareArgs>): this;
    /**
     * Convenience method to call start on the receiver
     *
     * TODO: args could be defined using a generic constraint from the receiver type
     *
     * @param args receiver-specific start arguments
     */
    start(...args: any[]): Promise<unknown>;
    stop(...args: any[]): Promise<unknown>;
    event<EventType extends string = string>(eventName: EventType, ...listeners: Middleware<SlackEventMiddlewareArgs<EventType>>[]): void;
    message(...listeners: Middleware<SlackEventMiddlewareArgs<'message'>>[]): void;
    message(pattern: string | RegExp, ...listeners: Middleware<SlackEventMiddlewareArgs<'message'>>[]): void;
    action<ActionType extends SlackAction = SlackAction>(actionId: string | RegExp, ...listeners: Middleware<SlackActionMiddlewareArgs<ActionType>>[]): void;
    action<ActionType extends SlackAction = SlackAction>(constraints: ActionConstraints, ...listeners: Middleware<SlackActionMiddlewareArgs<ActionType>>[]): void;
    command(commandName: string, ...listeners: Middleware<SlackCommandMiddlewareArgs>[]): void;
    options<Source extends OptionsSource = OptionsSource>(actionId: string | RegExp, ...listeners: Middleware<SlackOptionsMiddlewareArgs<Source>>[]): void;
    options<Source extends OptionsSource = OptionsSource>(constraints: ActionConstraints, ...listeners: Middleware<SlackOptionsMiddlewareArgs<Source>>[]): void;
    error(errorHandler: ErrorHandler): void;
    /**
     * Handles events from the receiver
     */
    private onIncomingEvent;
    /**
     * Global error handler. The final destination for all errors (hopefully).
     */
    private onGlobalError;
}
export interface AuthorizationError extends CodedError {
    code: ErrorCode.AuthorizationError;
    original: Error;
}
//# sourceMappingURL=App.d.ts.map